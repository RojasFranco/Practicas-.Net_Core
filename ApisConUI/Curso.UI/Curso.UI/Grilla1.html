<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta charset="utf-8" />
	<title>Login</title>
	<script src="js/jquery.js"></script>
	<style>
		.table {
			background-color: blue;
			border: 1px black solid;
		}

			.table tr td {
				min-width: 100px;
				border: 1px black solid;
			}


		.Contenedor-ppal{
			height:auto;
			width:300px;
			background-color: antiquewhite;
			text-align:center;
		}

        .Contenedor-datos {
            display: inline-block;
            height: auto;
            line-height: 100%;
            vertical-align: middle;
        }

		.botones{
			margin:40px;
			border:1px solid;
			
		}

		.seccionesEnCrearPersona{
			margin:20px;
			text-align:left;
			
		}

	</style>
	<script>		
		$(document).ready(function () {
			$("#CrearPersona").hide();
			//$("#tabla").hide();
			$("#btnVolverDeTabla").hide();
			$("#EliminaPersona").hide();

			$.fn.dibujarTabla = function (data) {
				let html = "";
				$.each(data.headers, function (index, value) {
					html += "<th>" + value + "</th>";
				});
				html = "<tr>" + html + "</tr>";
				let row = "";
				$.each(data.rows, function (index, value) {
					row = "";
					$.each(value, function (index, value) {
						row += "<td>" + value + "</td>";
					});
					html += "<tr>" + row + "</tr>"
				});
				html = "<table class='table'>" + html + "</table>"
				this.html(html);
			}

			
			$("#btnMostrarTabla").click(function () {

				$.ajax({
					url: "https://localhost:5003/api/Tables/Grilla1",
					method: "GET",
					crossDomain: true,
					headers: {
						"Accept": "application/json",
					},
					//data: JSON.stringify(data),
					dataType: 'json',
					contentType: "application/json; charset=utf-8",
					success: function (data) {						
						if (typeof data !== "object") {
							data = data.d || data;
							data = JSON.parse(data);
						}
						$("#Inicial").hide();
						$("#tabla").dibujarTabla(data);
						$("#tabla").show();
					},
					error: function (xhr) {
						alert((xhr.responseJSON).message)
						//console.log(xhr);
					}
				});
				$("#btnVolverDeTabla").show();
			})


			$("#btnAltaPersona").click(function () {
				$("#Inicial").hide();
                //$("#tabla").hide();
				$("#CrearPersona").show();				
			});

			$("#guardarPersona").click(function () {
				var nombreNew = $("#txtNombreIngresado").val();
				var apellidoNew = $("#txtApellidoIngresado").val();
				var dniNew = $("#txtDniIngresado").val();                				

				if (!isNaN(parseInt(dniNew)) && nombreNew.length > 2 && apellidoNew.length > 2) {

					var data = { nombreAlta: nombreNew, apellidoAlta: apellidoNew, dniAlta: parseInt(dniNew) }

					$.ajax({
						url: "https://localhost:5003/api/Tables/CrearPersona",
						data: JSON.stringify(data),
						crossDomain: true,
						dataType: 'json',
						headers: {
							"Accept": "application/json",
						},
						contentType: "application/json; charset=utf-8",
						method: "POST",
						success: function (respuesta) {
							debugger;
							alert(respuesta.message);
						},
						error: function (error) {
							debugger;
							let respuesta = error.responseJSON;

							alert(respuesta.message);
						}
					})
				}
				else {
					alert("Complete los campos")
                }
			});

			$("#btnVolver").click(function () {

                $("#CrearPersona").hide();
				$("#Inicial").show();
			});

			$("#btnVolverDeTabla").click(function () {
				$("#tabla").hide();
                $("#btnVolverDeTabla").hide();
				$("#Inicial").show();				
			});

            $("#btnVolverDeEliminar").click(function () {

                $("#EliminaPersona").hide();
                $("#Inicial").show();
            });

			$("#btnEliminarPersona").click(function () {
                $("#Inicial").hide();
				$("#EliminaPersona").show();
			});

			$("#btnEliminar").click(function () {
				var dniEliminar = $("#txtDniEliminar").val();
				if (!isNaN(parseInt(dniEliminar))) {
					
					//var data = { dniAEliminar: parseInt(dniEliminar) };

					var userEliminar = parseInt(dniEliminar);

					$.ajax({
                        url: "https://localhost:5003/api/Tables/BorrarPersona/" + userEliminar,
						method: "DELETE",                        
						//data: JSON.stringify(data), NO SE ENVIA NADA
						crossDomain: true,
						dataType: 'json',
						headers: {
							"Accept": "application/json",
						},
                        contentType: "application/json; charset=utf-8",
						success: function (respuesta) {
							let responder = respuesta.message;
							alert(responder);
						},
						error: function (error) {
							debugger;
							let respuesta = error.responseJSON;
							alert(respuesta.message);
						}

					});
				}
				else {
					alert("Dni ingresado no es valido");
                }

			});



		});
		
	</script>
</head>
<body>
	<div class="Contenedor-ppal" id="Inicial">
		<div class="Contenedor-datos">

			<div class="botones">
				<input type="button" value="Alta Persona" id="btnAltaPersona" />
			</div>
			<div class="botones">
				<input type="button" value="Mostrar Tabla" id="btnMostrarTabla" />
			</div>
			<div class="botones">
				<input type="button" value="Baja Persona" id="btnEliminarPersona" />
			</div>



		</div>

	</div>
	
	
	<div id="tabla"></div>
	<div class="btnVolverTabla" style="margin-top:20px" >
		<input type="button" value="Volver" id="btnVolverDeTabla" style="margin-left:120px" />
	</div>	

	<div class="Contenedor-ppal" id="CrearPersona">
		<div class="Contenedor-datos">

			<div class="seccionesEnCrearPersona">
				Nombre
				<input type="text" id="txtNombreIngresado" style="float:right" />
			</div>

			<div class="seccionesEnCrearPersona">
				Apellido
				<input type="text" id="txtApellidoIngresado" />

			</div>
			
			<div class="seccionesEnCrearPersona">
				DNI
				<input type="text" id="txtDniIngresado" style="float:right" />

			</div>

			<div>
				<input type="button" value="Crear" id="guardarPersona" />
				<input type="button" value="Volver" id="btnVolver" />
			</div>

		</div>

	</div>

	<div class="Contenedor-ppal" id="EliminaPersona">
		<div class="Contenedor-datos">

			<div class="seccionesEnCrearPersona">
				Dni:
				<input type="text" id="txtDniEliminar" />
			</div>

			<div >
				<input type="button" value="Eliminar" id="btnEliminar" />
				<input type="button" value="Volver" id="btnVolverDeEliminar" />
			</div>
		</div>


	</div>
	
</body>
</html>